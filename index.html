<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartel Empire - Underground Kingdom</title>
    <meta name="description" content="Jogo de estrat√©gia onde voc√™ constr√≥i e gerencia seu pr√≥prio cartel criminoso">
    <meta name="keywords" content="jogo, estrat√©gia, cartel, crime, simula√ß√£o">
    <meta name="author" content="Cartel Empire Team">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(45deg, #1a1a1a, #2d2d2d, #000);
            color: #fff;
            overflow: hidden;
        }

        .game-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #8B0000, #DC143C, #000);
            border-bottom: 3px solid #FFD700;
            padding: 10px;
            box-shadow: 0 2px 15px rgba(220, 20, 60, 0.5);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .logo {
            color: #FFD700;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .player-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .datetime {
            color: #FFD700;
            font-size: 12px;
            background: rgba(0,0,0,0.6);
            padding: 5px 10px;
            border-radius: 5px;
            border: 1px solid #DC143C;
        }

        .resources {
            display: flex;
            gap: 15px;
            background: rgba(139, 0, 0, 0.8);
            padding: 8px 15px;
            border-radius: 20px;
            border: 2px solid #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }

        .resource {
            display: flex;
            align-items: center;
            gap: 5px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .resource:hover {
            transform: scale(1.05);
        }

        .resource-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .drugs { background: #9932CC; }
        .money { background: #228B22; color: #000; }
        .weapons { background: #8B0000; }
        .influence { background: #FFD700; color: #000; }

        /* Alert System */
        .alert-level {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 0, 0, 0.2);
            padding: 5px 15px;
            border-radius: 15px;
            border: 2px solid #FF0000;
            color: #FF6347;
            font-weight: bold;
        }

        .alert-high {
            animation: alertBlink 1s infinite;
        }

        @keyframes alertBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.5; }
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            gap: 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: linear-gradient(135deg, #2F4F4F, #696969);
            border: 2px solid #8B0000;
            border-bottom: none;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #FFD700;
            font-weight: bold;
            position: relative;
            font-size: 14px;
        }

        .nav-tab:hover {
            background: linear-gradient(135deg, #696969, #A9A9A9);
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #FFD700;
            box-shadow: 0 2px 15px rgba(220, 20, 60, 0.5);
        }

        /* Main Game Area */
        .game-area {
            flex: 1;
            display: flex;
            position: relative;
        }

        .view {
            display: none;
        }

        .view.active {
            display: flex;
            flex: 1;
        }

        /* Territory View */
        .territory-view {
            flex: 1;
            position: relative;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.8), rgba(45, 45, 45, 0.8)),
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><defs><linearGradient id="skyGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23000;stop-opacity:1" /><stop offset="100%" style="stop-color:%231a1a1a;stop-opacity:1" /></linearGradient></defs><rect width="800" height="600" fill="url(%23skyGrad)"/><g opacity="0.3"><rect x="50" y="200" width="80" height="200" fill="%23333"/><rect x="150" y="150" width="100" height="250" fill="%23444"/><rect x="270" y="180" width="90" height="220" fill="%23333"/><rect x="380" y="160" width="110" height="240" fill="%23555"/><rect x="510" y="190" width="85" height="210" fill="%23333"/><rect x="620" y="140" width="120" height="260" fill="%23444"/></g><g opacity="0.5"><circle cx="150" cy="50" r="30" fill="%23FFD700" opacity="0.8"/><polygon points="140,45 160,45 155,35 145,35" fill="%23FFA500"/></g><g opacity="0.2"><rect x="100" y="350" width="600" height="10" fill="%23666"/><rect x="120" y="380" width="560" height="8" fill="%23555"/></g></svg>') no-repeat center center;
            background-size: cover;
            background-image: 
                linear-gradient(135deg, rgba(26, 26, 26, 0.7), rgba(45, 45, 45, 0.7)),
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 800"><defs><linearGradient id="nightSky" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" style="stop-color:%23001122;stop-opacity:1" /><stop offset="50%" style="stop-color:%23112233;stop-opacity:1" /><stop offset="100%" style="stop-color:%231a1a1a;stop-opacity:1" /></linearGradient><filter id="glow"><feGaussianBlur stdDeviation="3" result="coloredBlur"/><feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><rect width="1200" height="800" fill="url(%23nightSky)"/><g opacity="0.4"><rect x="50" y="400" width="60" height="300" fill="%23333" stroke="%23666" stroke-width="1"/><rect x="130" y="350" width="80" height="350" fill="%23444" stroke="%23777" stroke-width="1"/><rect x="230" y="380" width="70" height="320" fill="%23333" stroke="%23555" stroke-width="1"/><rect x="320" y="320" width="90" height="380" fill="%23555" stroke="%23888" stroke-width="1"/><rect x="430" y="360" width="75" height="340" fill="%23333" stroke="%23666" stroke-width="1"/><rect x="525" y="300" width="100" height="400" fill="%23444" stroke="%23777" stroke-width="1"/><rect x="645" y="340" width="85" height="360" fill="%23333" stroke="%23555" stroke-width="1"/><rect x="750" y="280" width="120" height="420" fill="%23555" stroke="%23888" stroke-width="1"/><rect x="890" y="320" width="95" height="380" fill="%23444" stroke="%23777" stroke-width="1"/><rect x="1005" y="360" width="80" height="340" fill="%23333" stroke="%23666" stroke-width="1"/></g><g opacity="0.6"><rect x="70" y="420" width="20" height="30" fill="%23FFD700" opacity="0.8"/><rect x="150" y="380" width="15" height="25" fill="%23FFA500" opacity="0.7"/><rect x="250" y="400" width="18" height="28" fill="%23FFD700" opacity="0.8"/><rect x="350" y="360" width="22" height="35" fill="%23FF6347" opacity="0.6"/><rect x="450" y="390" width="16" height="26" fill="%23FFD700" opacity="0.8"/><rect x="560" y="340" width="20" height="32" fill="%23FFA500" opacity="0.7"/><rect x="670" y="370" width="18" height="29" fill="%23FFD700" opacity="0.8"/><rect x="780" y="320" width="25" height="38" fill="%23FF4500" opacity="0.6"/><rect x="920" y="350" width="19" height="30" fill="%23FFD700" opacity="0.8"/><rect x="1025" y="380" width="17" height="27" fill="%23FFA500" opacity="0.7"/></g><g opacity="0.3"><rect x="0" y="650" width="1200" height="40" fill="%23222"/><rect x="0" y="680" width="1200" height="20" fill="%23444"/></g><g opacity="0.8" filter="url(%23glow)"><circle cx="100" cy="80" r="2" fill="%23FFD700"/><circle cx="300" cy="60" r="1.5" fill="%23FFF"/><circle cx="500" cy="70" r="2" fill="%23FFD700"/><circle cx="700" cy="50" r="1" fill="%23FFF"/><circle cx="900" cy="65" r="1.5" fill="%23FFD700"/><circle cx="1100" cy="55" r="2" fill="%23FFF"/></g><g opacity="0.5"><ellipse cx="200" cy="85" rx="40" ry="15" fill="%23666" opacity="0.4"/><ellipse cx="600" cy="75" rx="35" ry="12" fill="%23555" opacity="0.4"/><ellipse cx="1000" cy="80" rx="45" ry="18" fill="%23666" opacity="0.4"/></g></svg>'),
                radial-gradient(circle at 20% 80%, rgba(220, 20, 60, 0.1) 100px, transparent 100px),
                radial-gradient(circle at 80% 20%, rgba(255, 215, 0, 0.1) 80px, transparent 80px);
            background-size: cover, cover, 400px 400px, 300px 300px;
            background-position: center, center, left bottom, right top;
            background-repeat: no-repeat, no-repeat, no-repeat, no-repeat;
        }

        /* World Map View */
        .world-view {
            flex: 1;
            position: relative;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="citymap" patternUnits="userSpaceOnUse" width="20" height="20"><rect width="20" height="20" fill="%23111"/><rect x="5" y="5" width="2" height="2" fill="%23333" opacity="0.5"/><rect x="15" y="15" width="2" height="2" fill="%23333" opacity="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23citymap)"/></svg>') repeat;
            overflow: hidden;
        }

        .territory {
            position: absolute;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #2F4F4F, #000);
            border-radius: 10px;
            border: 3px solid #8B0000;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .territory:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.4);
        }

        .territory.player {
            border-color: #FFD700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .territory.enemy {
            border-color: #FF4500;
        }

        .territory.neutral {
            border-color: #696969;
        }

        .territory.cartel {
            border-color: #9932CC;
        }

        /* Operations View */
        .operations-view {
            flex: 1;
            background: linear-gradient(135deg, #2F4F4F, #000);
            padding: 20px;
            overflow-y: auto;
        }

        .operation-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #8B0000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .unit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .unit-card {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border: 2px solid #8B0000;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #fff;
        }

        .unit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(220, 20, 60, 0.3);
            border-color: #DC143C;
        }

        .unit-icon {
            font-size: 30px;
            margin-bottom: 10px;
        }

        /* Research View */
        .research-view {
            flex: 1;
            background: linear-gradient(135deg, #191970, #000080);
            padding: 20px;
            overflow-y: auto;
        }

        .tech-tree {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .tech-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 2px solid #8B0000;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            color: #fff;
        }

        .tech-card.researched {
            background: linear-gradient(135deg, #228B22, #006400);
            border-color: #32CD32;
        }

        .tech-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tech-card:hover:not(.locked) {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(220, 20, 60, 0.4);
        }

        /* Buildings */
        .building {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            transform-style: preserve-3d;
        }

        .building:hover {
            transform: scale(1.1) translateZ(10px);
            filter: brightness(1.2);
        }

        .building-sprite {
            width: 80px;
            height: 80px;
            border-radius: 15px;
            border: 2px solid #8B0000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            position: relative;
            overflow: hidden;
        }

        .building-sprite::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,215,0,0.2) 50%, transparent 70%);
            animation: shine 4s infinite;
        }

        @keyframes shine {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .headquarters { background: linear-gradient(135deg, #8B0000, #DC143C); }
        .lab { background: linear-gradient(135deg, #9932CC, #4B0082); }
        .warehouse { background: linear-gradient(135deg, #2F4F4F, #696969); }
        .safehouse { background: linear-gradient(135deg, #8B4513, #A0522D); }
        .dealership { background: linear-gradient(135deg, #228B22, #006400); }
        .armory { background: linear-gradient(135deg, #B22222, #8B0000); }
        .laundry { background: linear-gradient(135deg, #DAA520, #B8860B); }
        .lookout { background: linear-gradient(135deg, #4682B4, #1E90FF); }

        .building-level {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #FFD700;
            color: #000;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid #8B0000;
        }

        /* Side Panel */
        .side-panel {
            width: 320px;
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border-left: 3px solid #8B0000;
            padding: 20px;
            overflow-y: auto;
            box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        }

        .panel-section {
            background: rgba(255,255,255,0.1);
            margin-bottom: 20px;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #8B0000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
            color: #FFD700;
            margin-bottom: 10px;
            text-align: center;
            text-transform: uppercase;
        }

        .building-info h3 {
            color: #DC143C;
            margin-bottom: 10px;
        }

        .building-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .stat {
            background: rgba(0,0,0,0.5);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #8B0000;
            color: #fff;
        }

        .upgrade-btn, .action-btn {
            width: 100%;
            background: linear-gradient(135deg, #8B0000, #DC143C);
            border: none;
            padding: 12px;
            border-radius: 8px;
            color: #FFD700;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
            margin: 5px 0;
        }

        .upgrade-btn:hover, .action-btn:hover {
            background: linear-gradient(135deg, #DC143C, #B22222);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 20, 60, 0.5);
        }

        .upgrade-btn:disabled, .action-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .green-btn {
            background: linear-gradient(135deg, #228B22, #006400) !important;
            box-shadow: 0 4px 15px rgba(34, 139, 34, 0.4) !important;
        }

        .green-btn:hover {
            background: linear-gradient(135deg, #006400, #004d00) !important;
        }

        .purple-btn {
            background: linear-gradient(135deg, #9932CC, #4B0082) !important;
            box-shadow: 0 4px 15px rgba(153, 50, 204, 0.4) !important;
        }

        .gold-btn {
            background: linear-gradient(135deg, #DAA520, #B8860B) !important;
            color: #000 !important;
            box-shadow: 0 4px 15px rgba(218, 165, 32, 0.4) !important;
        }

        /* Input fields */
        .game-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #8B0000;
            border-radius: 8px;
            font-size: 14px;
            margin: 5px 0;
            background: rgba(0,0,0,0.7);
            color: #fff;
        }

        .game-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #8B0000;
            border-radius: 8px;
            font-size: 14px;
            margin: 5px 0;
            background: rgba(0,0,0,0.7);
            color: #fff;
        }

        /* Risk Level */
        .risk-meter {
            width: 100%;
            height: 25px;
            background: #333;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            border: 2px solid #8B0000;
        }

        .risk-fill {
            height: 100%;
            background: linear-gradient(90deg, #228B22, #FFD700, #FF4500, #DC143C);
            transition: width 0.3s ease;
        }

        /* Animations */
        @keyframes buildingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .upgrading {
            animation: buildingPulse 1s infinite;
        }

        .police-raid {
            animation: policeFlash 0.5s infinite;
        }

        @keyframes policeFlash {
            0%, 50% { background: rgba(255, 0, 0, 0.3); }
            51%, 100% { background: rgba(0, 0, 255, 0.3); }
        }

        /* Resource Production Animation */
        .resource-popup {
            position: absolute;
            pointer-events: none;
            color: #FFD700;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            animation: resourceFloat 2s ease-out forwards;
        }

        @keyframes resourceFloat {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        /* Tooltip */
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: #FFD700;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            max-width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.8);
            border: 2px solid #8B0000;
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 3px solid #8B0000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            position: relative;
            color: #fff;
        }

        .modal-header {
            text-align: center;
            font-size: 24px;
            color: #FFD700;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #FFD700;
        }

        /* Rival Operations */
        .rival-operation {
            background: rgba(220, 20, 60, 0.2);
            border: 2px solid #DC143C;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .side-panel {
                width: 100%;
                height: 50vh;
                position: fixed;
                bottom: 0;
                left: 0;
                z-index: 100;
                transform: translateY(calc(50vh - 60px));
                transition: transform 0.3s ease;
            }

            .side-panel.expanded {
                transform: translateY(0);
            }

            .game-area {
                padding-bottom: 60px;
            }

            .resources {
                flex-wrap: wrap;
                gap: 8px;
            }

            .nav-tabs {
                flex-wrap: wrap;
            }

            .building-sprite {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }

            .tech-tree {
                grid-template-columns: repeat(2, 1fr);
            }

            .unit-grid {
                grid-template-columns: 1fr;
            }

            .logo {
                font-size: 18px;
            }

            .nav-tab {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000, #1a1a1a);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: #FFD700;
        }

        .loading-logo {
            font-size: 48px;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .loading-bar {
            width: 300px;
            height: 6px;
            background: #333;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #8B0000, #DC143C);
            animation: loading 3s ease-out forwards;
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-logo">üíÄ CARTEL EMPIRE</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <div>Carregando opera√ß√µes criminosas...</div>
    </div>

    <div class="game-container" style="display: none;" id="gameContainer">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="logo" onclick="showBonusModal()">
                    üíÄ CARTEL EMPIRE
                    <div class="alert-level" id="alertLevel">
                        üö® RISCO: <span id="riskLevel">BAIXO</span>
                    </div>
                </div>
                <div class="player-info">
                    <div class="datetime" id="datetime"></div>
                    <div class="resources">
                        <div class="resource" onclick="showResourceInfo('drugs')">
                            <div class="resource-icon drugs">üíä</div>
                            <span id="drugs">50</span>kg
                        </div>
                        <div class="resource" onclick="showResourceInfo('money')">
                            <div class="resource-icon money">üí∞</div>
                            <span id="money">25000</span>
                        </div>
                        <div class="resource" onclick="showResourceInfo('weapons')">
                            <div class="resource-icon weapons">üî´</div>
                            <span id="weapons">15</span>
                        </div>
                        <div class="resource" onclick="showResourceInfo('influence')">
                            <div class="resource-icon influence">üëë</div>
                            <span id="influence">75</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="nav-tabs">
                <div class="nav-tab active" data-tab="territory">üè≠ Territ√≥rio</div>
                <div class="nav-tab" data-tab="operations">‚öîÔ∏è Opera√ß√µes</div>
                <div class="nav-tab" data-tab="research">üß™ Pesquisas</div>
                <div class="nav-tab" data-tab="world">üåÜ Cidade</div>
                <div class="nav-tab" data-tab="cartel">ü§ù Cartel</div>
                <div class="nav-tab" data-tab="intelligence">üïµÔ∏è Intel</div>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="game-area">
            <!-- Territory View -->
            <div class="view territory-view active" id="territoryView">
                <!-- Buildings will be dynamically added here -->
            </div>

            <!-- World Map View -->
            <div class="view world-view" id="worldView">
                <!-- Territories will be dynamically added here -->
            </div>

            <!-- Operations View -->
            <div class="view operations-view" id="operationsView">
                <div class="operation-section">
                    <h2 style="color: #FFD700; text-align: center; margin-bottom: 20px;">üë• Sua Organiza√ß√£o</h2>
                    <div class="unit-grid" id="organizationGrid">
                        <!-- Organization units will be added here -->
                    </div>
                </div>

                <div class="operation-section">
                    <h2 style="color: #FFD700; text-align: center; margin-bottom: 20px;">üìã Recrutar Pessoal</h2>
                    <div class="unit-grid" id="recruitGrid">
                        <!-- Recruitment options will be added here -->
                    </div>
                </div>
            </div>

            <!-- Research View -->
            <div class="view research-view" id="researchView">
                <h2 style="color: #FFD700; text-align: center; margin-bottom: 30px;">üß™ Pesquisa & Desenvolvimento</h2>
                <div class="tech-tree" id="techTree">
                    <!-- Research options will be added here -->
                </div>
            </div>

            <!-- Cartel View -->
            <div class="view" id="cartelView">
                <div style="padding: 20px; color: #FFD700; text-align: center;">
                    <h2>ü§ù Sistema de Cartel</h2>
                    <p>Alian√ßas entre organiza√ß√µes criminosas em desenvolvimento...</p>
                    <div class="operation-section" style="margin-top: 30px;">
                        <h3>üè¥‚Äç‚ò†Ô∏è Cart√©is Dispon√≠veis</h3>
                        <div class="rival-operation">
                            <div>
                                <strong>Los Hermanos</strong><br>
                                <small>Especialistas em tr√°fico internacional</small>
                            </div>
                            <button class="action-btn purple-btn" onclick="showNotification('ü§ù Sistema em desenvolvimento!')">ü§ù Propor Alian√ßa</button>
                        </div>
                        <div class="rival-operation">
                            <div>
                                <strong>M√°fia Italiana</strong><br>
                                <small>Controla lavagem de dinheiro</small>
                            </div>
                            <button class="action-btn gold-btn" onclick="showNotification('üí∞ Sistema em desenvolvimento!')">üí∞ Negociar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Intelligence View -->
            <div class="view" id="intelligenceView">
                <div style="padding: 20px; color: #FFD700;">
                    <h2 style="text-align: center;">üïµÔ∏è Central de Intelig√™ncia</h2>
                    <div class="operation-section">
                        <h3>üìä Relat√≥rios de Espionagem</h3>
                        <div class="rival-operation">
                            <div>
                                <strong>üéØ Opera√ß√£o Vigil√¢ncia</strong><br>
                                <small>Monitoramento de rivais ativos</small>
                            </div>
                            <button class="action-btn green-btn" onclick="showIntelReport()">üìã Ver Relat√≥rio</button>
                        </div>
                        <div class="rival-operation">
                            <div>
                                <strong>üîç An√°lise de Mercado</strong><br>
                                <small>Tend√™ncias e oportunidades</small>
                            </div>
                            <button class="action-btn purple-btn" onclick="showMarketAnalysis()">üìà Analisar</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Side Panel -->
            <div class="side-panel" id="sidePanel">
                <div class="panel-section">
                    <div class="panel-title">üìä Status do Cartel</div>
                    <div class="building-stats">
                        <div class="stat">
                            <div>Territ√≥rio</div>
                            <div id="territoryControl">45%</div>
                        </div>
                        <div class="stat">
                            <div>Reputa√ß√£o</div>
                            <div id="reputation">‚≠ê 8.2</div>
                        </div>
                        <div class="stat">
                            <div>Membros</div>
                            <div id="members">127</div>
                        </div>
                        <div class="stat">
                            <div>Ranking</div>
                            <div id="ranking">#3</div>
                        </div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <strong>N√≠vel de Risco:</strong>
                        <div class="risk-meter">
                            <div class="risk-fill" id="riskMeter" style="width: 25%;"></div>
                        </div>
                    </div>
                </div>

                <div class="panel-section building-info" id="buildingInfo">
                    <div class="panel-title">üè¢ Quartel General</div>
                    <h3>N√≠vel 3</h3>
                    <p>Centro de comando do seu imp√©rio criminoso. Coordena todas as opera√ß√µes.</p>
                    
                    <div class="building-stats">
                        <div class="stat">
                            <div>Capacidade</div>
                            <div>150 membros</div>
                        </div>
                        <div class="stat">
                            <div>Pr√≥ximo N√≠vel</div>
                            <div>200 membros</div>
                        </div>
                    </div>

                    <div style="margin: 15px 0;">
                        <strong>Custo do Upgrade:</strong><br>
                        üí∞ $50.000 üî´ 25 armas üëë 15 influ√™ncia
                    </div>

                    <button class="upgrade-btn" onclick="upgradeBuilding('headquarters')">
                        ‚¨ÜÔ∏è Expandir Opera√ß√£o
                    </button>
                </div>

                <div class="panel-section">
                    <div class="panel-title">üìà Produ√ß√£o/Hora</div>
                    <div class="building-stats">
                        <div class="stat">
                            <div>üíä Drogas</div>
                            <div id="drugsProduction">+8kg</div>
                        </div>
                        <div class="stat">
                            <div>üí∞ Dinheiro</div>
                            <div id="moneyProduction">+$2.5K</div>
                        </div>
                        <div class="stat">
                            <div>üî´ Armas</div>
                            <div id="weaponsProduction">+3</div>
                        </div>
                        <div class="stat">
                            <div>üëë Influ√™ncia</div>
                            <div id="influenceProduction">+2</div>
                        </div>
                    </div>
                </div>

                <div class="panel-section">
                    <div class="panel-title">üö® Atividade Policial</div>
                    <div class="building-stats">
                        <div class="stat">
                            <div>Batidas</div>
                            <div>3 esta semana</div>
                        </div>
                        <div class="stat">
                            <div>Investiga√ß√µes</div>
                            <div>2 ativas</div>
                        </div>
                    </div>
                    <button class="action-btn purple-btn" onclick="showPoliceActivity()">
                        üïµÔ∏è Ver Intel Policial
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="gameModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal()">&times;</button>
            <div class="modal-header" id="modalHeader">T√≠tulo</div>
            <div id="modalBody">Conte√∫do do modal</div>
        </div>
    </div>

    <script>
        // Game State com Save/Load autom√°tico
        let gameState = {
            resources: {
                drugs: 50,      // kg
                money: 25000,   // dollars
                weapons: 15,    // units
                influence: 75   // points
            },
            buildings: {
                headquarters: { level: 3, x: 200, y: 150 },
                lab: { level: 2, x: 350, y: 200 },
                warehouse: { level: 2, x: 100, y: 250 },
                safehouse: { level: 1, x: 400, y: 120 },
                dealership: { level: 1, x: 150, y: 350 },
                armory: { level: 1, x: 320, y: 280 },
                laundry: { level: 1, x: 450, y: 320 },
                lookout: { level: 1, x: 50, y: 150 }
            },
            organization: {
                chemist: 8,
                dealer: 15,
                enforcer: 12,
                lieutenant: 3
            },
            research: {
                chemistry: { completed: true, level: 2 },
                security: { completed: true, level: 1 },
                distribution: { completed: false, level: 0 },
                corruption: { completed: false, level: 0 },
                manufacturing: { completed: false, level: 0 },
                intelligence: { completed: false, level: 0 }
            },
            territoryControl: 45,
            reputation: 8.2,
            members: 127,
            ranking: 3,
            riskLevel: 25,
            currentView: 'territory',
            version: '1.0.0'
        };

        // Building definitions
        const buildingTypes = {
            headquarters: { 
                name: 'Quartel General', 
                icon: 'üè¢', 
                baseProduction: { influence: 2 },
                upgradeCost: { money: 50000, weapons: 25, influence: 15 },
                description: 'Centro de comando do seu imp√©rio. Coordena todas as opera√ß√µes.'
            },
            lab: { 
                name: 'Laborat√≥rio', 
                icon: 'üß™', 
                baseProduction: { drugs: 4 },
                upgradeCost: { money: 30000, influence: 10 },
                description: 'Produz drogas sint√©ticas de alta qualidade.'
            },
            warehouse: { 
                name: 'Dep√≥sito', 
                icon: 'üì¶', 
                baseProduction: {},
                upgradeCost: { money: 20000, weapons: 15 },
                description: 'Armazena produtos e esconde evid√™ncias.'
            },
            safehouse: { 
                name: 'Casa Segura', 
                icon: 'üè†', 
                baseProduction: {},
                upgradeCost: { money: 25000, influence: 8 },
                description: 'Ref√∫gio para membros em perigo.'
            },
            dealership: { 
                name: 'Ponto de Venda', 
                icon: 'üè™', 
                baseProduction: { money: 1200 },
                upgradeCost: { money: 35000, drugs: 20, influence: 12 },
                description: 'Distribui produtos nas ruas.'
            },
            armory: { 
                name: 'Arsenal', 
                icon: 'üî´', 
                baseProduction: { weapons: 2 },
                upgradeCost: { money: 40000, influence: 20 },
                description: 'Armazena e mant√©m armamento pesado.'
            },
            laundry: { 
                name: 'Lavanderia', 
                icon: 'üè¶', 
                baseProduction: { money: 800 },
                upgradeCost: { money: 60000, influence: 25 },
                description: 'Lava dinheiro atrav√©s de neg√≥cios leg√≠timos.'
            },
            lookout: { 
                name: 'Ponto de Observa√ß√£o', 
                icon: 'üëÅÔ∏è', 
                baseProduction: {},
                upgradeCost: { money: 15000, weapons: 10 },
                description: 'Monitora atividade policial e rivais.'
            }
        };

        // Unit definitions
        const unitTypes = {
            chemist: {
                name: 'Qu√≠mico',
                icon: 'üë®‚Äçüî¨',
                cost: { money: 5000, influence: 5 },
                skill: 'Produ√ß√£o de drogas',
                description: 'Especialista em s√≠ntese qu√≠mica.',
                bonus: '+25% produ√ß√£o de drogas'
            },
            dealer: {
                name: 'Traficante',
                icon: 'üï¥Ô∏è',
                cost: { money: 3000, drugs: 2 },
                skill: 'Vendas',
                description: 'Distribui produtos nas ruas.',
                bonus: '+15% receita de vendas'
            },
            enforcer: {
                name: 'Capanga',
                icon: 'üí™',
                cost: { money: 4000, weapons: 3 },
                skill: 'Combate',
                description: 'Protege territ√≥rio e intimida rivais.',
                bonus: '+20% defesa territorial'
            },
            lieutenant: {
                name: 'Tenente',
                icon: 'üëî',
                cost: { money: 10000, influence: 10 },
                skill: 'Lideran√ßa',
                description: 'Coordena opera√ß√µes complexas.',
                bonus: '+30% efici√™ncia geral'
            }
        };

        // Research definitions
        const researchTypes = {
            chemistry: {
                name: 'Qu√≠mica Avan√ßada',
                icon: '‚öóÔ∏è',
                cost: { money: 15000, drugs: 10 },
                description: 'Melhora qualidade e pureza das drogas',
                benefits: 'Produ√ß√£o de drogas +40%'
            },
            security: {
                name: 'Seguran√ßa',
                icon: 'üõ°Ô∏è',
                cost: { money: 20000, weapons: 15 },
                description: 'Reduz risco de batidas policiais',
                benefits: 'Risco policial -30%'
            },
            distribution: {
                name: 'Rede de Distribui√ß√£o',
                icon: 'üöö',
                cost: { money: 25000, influence: 15 },
                description: 'Expande rotas de tr√°fico',
                benefits: 'Receita de vendas +50%'
            },
            corruption: {
                name: 'Corrup√ß√£o',
                icon: 'ü§ù',
                cost: { money: 40000, influence: 25 },
                description: 'Suborna autoridades',
                benefits: 'Imunidade policial tempor√°ria'
            },
            manufacturing: {
                name: 'Produ√ß√£o em Massa',
                icon: 'üè≠',
                cost: { money: 30000, drugs: 25 },
                description: 'Automatiza produ√ß√£o de drogas',
                benefits: 'Produ√ß√£o 24/7 sem qu√≠micos'
            },
            intelligence: {
                name: 'Rede de Espionagem',
                icon: 'üïµÔ∏è',
                cost: { money: 35000, influence: 20 },
                description: 'Obt√©m informa√ß√µes sobre rivais',
                benefits: 'Ataques +60% precis√£o'
            }
        };

        // Loading screen management
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'flex';
                initGame();
            }, 3500);
        });

        // Save/Load System
        function saveGame() {
            try {
                localStorage.setItem('cartelEmpire', JSON.stringify(gameState));
            } catch (e) {
                console.log('Save failed:', e);
            }
        }

        function loadGame() {
            try {
                const savedGame = localStorage.getItem('cartelEmpire');
                if (savedGame) {
                    const loadedState = JSON.parse(savedGame);
                    gameState = { ...gameState, ...loadedState };
                    showNotification('üéÆ Progresso carregado!');
                }
            } catch (e) {
                console.log('Load failed:', e);
                showNotification('‚ö†Ô∏è Erro ao carregar save. Novo jogo iniciado.');
            }
        }

        // Auto-save every 30 seconds
        setInterval(saveGame, 30000);

        // Initialize game
        function initGame() {
            loadGame();
            
            updateDateTime();
            renderBuildings();
            renderWorldMap();
            renderOperations();
            renderResearch();
            updateResources();
            updateProductionDisplay();
            updateRiskLevel();
            startResourceProduction();
            startPoliceActivity();
            
            setInterval(updateDateTime, 1000);
            setInterval(updateRiskLevel, 10000);
            setInterval(() => {
                if (Math.random() < 0.1) {
                    triggerRandomEvent();
                }
            }, 45000);
        }

        function updateDateTime() {
            const now = new Date();
            const formatted = now.toLocaleString('pt-BR');
            document.getElementById('datetime').textContent = formatted;
        }

        function renderBuildings() {
            const territoryView = document.getElementById('territoryView');
            territoryView.querySelectorAll('.building').forEach(b => b.remove());

            Object.entries(gameState.buildings).forEach(([type, building]) => {
                const buildingEl = createBuildingElement(type, building);
                territoryView.appendChild(buildingEl);
            });
        }

        function createBuildingElement(type, building) {
            const buildingEl = document.createElement('div');
            buildingEl.className = `building ${type}`;
            buildingEl.style.left = building.x + 'px';
            buildingEl.style.top = building.y + 'px';
            
            const buildingType = buildingTypes[type];
            buildingEl.innerHTML = `
                <div class="building-sprite ${type}">
                    ${buildingType.icon}
                    <div class="building-level">${building.level}</div>
                </div>
            `;

            buildingEl.addEventListener('click', () => selectBuilding(type));
            buildingEl.addEventListener('mouseenter', (e) => showTooltip(e, type, building));
            buildingEl.addEventListener('mouseleave', hideTooltip);

            return buildingEl;
        }

        function renderWorldMap() {
            const worldView = document.getElementById('worldView');
            worldView.innerHTML = '';

            const territories = [
                { x: 200, y: 150, type: 'player', name: 'Seu Territ√≥rio', control: 100 },
                { x: 400, y: 100, type: 'enemy', name: 'Cartel Los Hermanos', control: 0 },
                { x: 150, y: 300, type: 'neutral', name: 'Zona Neutra', control: 0 },
                { x: 500, y: 250, type: 'cartel', name: 'Aliados da M√°fia', control: 30 },
                { x: 300, y: 350, type: 'enemy', name: 'Gangue Rival', control: 0 },
                { x: 100, y: 100, type: 'neutral', name: 'Porto Comercial', control: 0 },
                { x: 450, y: 350, type: 'player', name: 'Territ√≥rio Expandido', control: 75 }
            ];

            territories.forEach(territory => {
                const territoryEl = document.createElement('div');
                territoryEl.className = `territory ${territory.type}`;
                territoryEl.style.left = territory.x + 'px';
                territoryEl.style.top = territory.y + 'px';
                
                const icon = territory.type === 'player' ? 'üëë' : 
                           territory.type === 'enemy' ? 'üíÄ' : 
                           territory.type === 'cartel' ? 'ü§ù' : 'üè¢';
                           
                territoryEl.textContent = icon;
                
                territoryEl.addEventListener('click', () => {
                    if (territory.type === 'enemy') {
                        attackTerritory(territory);
                    } else if (territory.type === 'neutral') {
                        expandTerritory(territory);
                    } else {
                        showTerritoryInfo(territory);
                    }
                });

                territoryEl.addEventListener('mouseenter', (e) => {
                    showTooltip(e, 'territory', territory);
                });
                territoryEl.addEventListener('mouseleave', hideTooltip);

                worldView.appendChild(territoryEl);
            });
        }

        function renderOperations() {
            const organizationGrid = document.getElementById('organizationGrid');
            const recruitGrid = document.getElementById('recruitGrid');
            
            organizationGrid.innerHTML = '';
            recruitGrid.innerHTML = '';

            // Show current organization
            Object.entries(gameState.organization).forEach(([unitType, count]) => {
                const unit = unitTypes[unitType];
                const unitCard = document.createElement('div');
                unitCard.className = 'unit-card';
                unitCard.innerHTML = `
                    <div class="unit-icon">${unit.icon}</div>
                    <h4>${unit.name}</h4>
                    <p>Quantidade: <strong>${count}</strong></p>
                    <p>${unit.skill}</p>
                    <p><small>${unit.bonus}</small></p>
                    <button class="action-btn purple-btn" onclick="deployUnit('${unitType}')">
                        üéØ Enviar Miss√£o
                    </button>
                `;
                organizationGrid.appendChild(unitCard);
            });

            // Show recruitment options
            Object.entries(unitTypes).forEach(([unitType, unit]) => {
                const unitCard = document.createElement('div');
                unitCard.className = 'unit-card';
                const canAfford = canAffordUnit(unitType);
                
                unitCard.innerHTML = `
                    <div class="unit-icon">${unit.icon}</div>
                    <h4>${unit.name}</h4>
                    <p>${unit.description}</p>
                    <p><small>${formatCosts(unit.cost)}</small></p>
                    <div>
                        <input type="number" class="game-input" id="recruit_${unitType}" min="1" max="5" value="1" style="width: 70px; display: inline-block; margin-right: 10px;">
                        <button class="action-btn green-btn ${!canAfford ? 'disabled' : ''}" 
                                onclick="recruitMultipleUnits('${unitType}')" 
                                ${!canAfford ? 'disabled' : ''}>
                            üë• Recrutar
                        </button>
                    </div>
                `;
                recruitGrid.appendChild(unitCard);
            });
        }

        function renderResearch() {
            const techTree = document.getElementById('techTree');
            techTree.innerHTML = '';

            Object.entries(researchTypes).forEach(([techType, tech]) => {
                const research = gameState.research[techType];
                const canAfford = canAffordResearch(techType);
                const isLocked = !canResearch(techType);
                
                const techCard = document.createElement('div');
                techCard.className = `tech-card ${research.completed ? 'researched' : ''} ${isLocked ? 'locked' : ''}`;
                
                techCard.innerHTML = `
                    <div style="font-size: 40px; margin-bottom: 10px;">${tech.icon}</div>
                    <h3>${tech.name}</h3>
                    <p style="font-size: 12px; margin: 10px 0;">${tech.description}</p>
                    <p style="font-size: 10px; color: #FFD700;">${tech.benefits}</p>
                    ${!research.completed && !isLocked ? `
                        <div style="margin-top: 15px;">
                            <small>${formatCosts(tech.cost)}</small>
                            <button class="action-btn ${!canAfford ? 'disabled' : ''}" 
                                    onclick="startResearch('${techType}')" 
                                    ${!canAfford ? 'disabled' : ''}>
                                üß™ Pesquisar
                            </button>
                        </div>
                    ` : ''}
                    ${research.completed ? '<p style="color: #32CD32; font-weight: bold;">‚úÖ Conclu√≠do</p>' : ''}
                    ${isLocked ? '<p style="color: #FF6347;">üîí Bloqueado</p>' : ''}
                `;
                
                techTree.appendChild(techCard);
            });
        }

        function selectBuilding(type) {
            const building = gameState.buildings[type];
            const buildingType = buildingTypes[type];
            
            document.getElementById('buildingInfo').innerHTML = `
                <div class="panel-title">${buildingType.icon} ${buildingType.name}</div>
                <h3>N√≠vel ${building.level}</h3>
                <p>${buildingType.description}</p>
                
                <div class="building-stats">
                    <div class="stat">
                        <div>N√≠vel Atual</div>
                        <div>${building.level}</div>
                    </div>
                    <div class="stat">
                        <div>Pr√≥ximo N√≠vel</div>
                        <div>${building.level + 1}</div>
                    </div>
                </div>

                <div style="margin: 15px 0;">
                    <strong>Custo do Upgrade:</strong><br>
                    ${formatCosts(calculateUpgradeCost(type))}
                </div>

                <button class="upgrade-btn ${canAffordUpgrade(type) ? '' : 'disabled'}" 
                        onclick="upgradeBuilding('${type}')" 
                        ${!canAffordUpgrade(type) ? 'disabled' : ''}>
                    ‚¨ÜÔ∏è Expandir Opera√ß√£o
                </button>
                
                ${type === 'headquarters' ? `
                    <button class="action-btn gold-btn" onclick="showCartelStats()">
                        üìä Relat√≥rio Completo
                    </button>
                ` : ''}
            `;
        }

        function formatCosts(costs) {
            const icons = { 
                drugs: 'üíä', 
                money: 'üí∞ $', 
                weapons: 'üî´', 
                influence: 'üëë' 
            };
            return Object.entries(costs)
                .map(([resource, amount]) => {
                    if (resource === 'money') {
                        return `${icons[resource]}${amount.toLocaleString()}`;
                    }
                    return `${icons[resource]} ${amount}`;
                })
                .join(' ');
        }

        function canAffordUpgrade(type) {
            const costs = calculateUpgradeCost(type);
            return Object.entries(costs).every(([resource, amount]) => 
                gameState.resources[resource] >= amount
            );
        }

        function canAffordUnit(unitType) {
            const costs = unitTypes[unitType].cost;
            return Object.entries(costs).every(([resource, amount]) => 
                gameState.resources[resource] >= amount
            );
        }

        function canAffordResearch(techType) {
            const costs = researchTypes[techType].cost;
            return Object.entries(costs).every(([resource, amount]) => 
                gameState.resources[resource] >= amount
            );
        }

        function canResearch(techType) {
            const prerequisites = {
                distribution: ['chemistry'],
                manufacturing: ['chemistry', 'security'],
                intelligence: ['security'],
                corruption: ['security', 'distribution']
            };

            if (!prerequisites[techType]) return true;
            
            return prerequisites[techType].every(prereq => 
                gameState.research[prereq].completed
            );
        }

        function calculateUpgradeCost(type) {
            const baseCost = buildingTypes[type].upgradeCost;
            const level = gameState.buildings[type].level;
            const multiplier = Math.pow(1.8, level - 1);
            
            const adjustedCost = {};
            Object.entries(baseCost).forEach(([resource, amount]) => {
                adjustedCost[resource] = Math.floor(amount * multiplier);
            });
            
            return adjustedCost;
        }

        function upgradeBuilding(type) {
            if (!canAffordUpgrade(type)) return;

            const costs = calculateUpgradeCost(type);
            
            Object.entries(costs).forEach(([resource, amount]) => {
                gameState.resources[resource] -= amount;
            });

            gameState.buildings[type].level++;
            gameState.riskLevel += 5;

            const buildingEl = document.querySelector(`.building.${type}`);
            buildingEl.classList.add('upgrading');
            setTimeout(() => buildingEl.classList.remove('upgrading'), 2000);

            updateResources();
            updateProductionDisplay();
            renderBuildings();
            selectBuilding(type);
            saveGame();

            showResourcePopup(buildingEl, '‚¨ÜÔ∏è UPGRADE!', '#32CD32');
            showNotification(`${buildingTypes[type].name} expandida com sucesso!`);
        }

        function recruitMultipleUnits(unitType) {
            const quantity = parseInt(document.getElementById(`recruit_${unitType}`).value) || 1;
            if (!canAffordUnit(unitType)) return;

            const costs = unitTypes[unitType].cost;
            
            for (let i = 0; i < quantity; i++) {
                if (!canAffordUnit(unitType)) break;
                
                Object.entries(costs).forEach(([resource, amount]) => {
                    gameState.resources[resource] -= amount;
                });
                gameState.organization[unitType] = (gameState.organization[unitType] || 0) + 1;
            }

            gameState.members = Object.values(gameState.organization).reduce((sum, count) => sum + count, 0);
            gameState.riskLevel += quantity * 2;

            updateResources();
            renderOperations();
            saveGame();

            showNotification(`${quantity}x ${unitTypes[unitType].name} recrutado(s)!`);
        }

        function startResearch(techType) {
            if (!canAffordResearch(techType) || !canResearch(techType)) return;

            const costs = researchTypes[techType].cost;
            
            Object.entries(costs).forEach(([resource, amount]) => {
                gameState.resources[resource] -= amount;
            });

            gameState.research[techType].completed = true;
            gameState.research[techType].level = 1;

            updateResources();
            updateProductionDisplay();
            renderResearch();
            saveGame();

            showNotification(`üß™ Pesquisa ${researchTypes[techType].name} conclu√≠da!`);
        }

        function updateResources() {
            Object.entries(gameState.resources).forEach(([resource, amount]) => {
                document.getElementById(resource).textContent = amount.toLocaleString();
            });
            
            document.getElementById('territoryControl').textContent = gameState.territoryControl + '%';
            document.getElementById('reputation').textContent = '‚≠ê ' + gameState.reputation;
            document.getElementById('members').textContent = gameState.members;
            document.getElementById('ranking').textContent = '#' + gameState.ranking;
        }

        function updateProductionDisplay() {
            const production = calculateProduction();
            
            document.getElementById('drugsProduction').textContent = `+${production.drugs}kg`;
            document.getElementById('moneyProduction').textContent = `+$${production.money.toLocaleString()}`;
            document.getElementById('weaponsProduction').textContent = `+${production.weapons}`;
            document.getElementById('influenceProduction').textContent = `+${production.influence}`;
        }

        function updateRiskLevel() {
            gameState.riskLevel = Math.min(100, gameState.riskLevel + Math.random() * 2);
            
            if (gameState.research.security.completed) {
                gameState.riskLevel = Math.max(0, gameState.riskLevel - 1);
            }

            const riskMeter = document.getElementById('riskMeter');
            const riskLevelSpan = document.getElementById('riskLevel');
            const alertLevel = document.getElementById('alertLevel');

            riskMeter.style.width = gameState.riskLevel + '%';

            if (gameState.riskLevel < 30) {
                riskLevelSpan.textContent = 'BAIXO';
                alertLevel.className = 'alert-level';
            } else if (gameState.riskLevel < 70) {
                riskLevelSpan.textContent = 'M√âDIO';
                alertLevel.className = 'alert-level';
            } else {
                riskLevelSpan.textContent = 'ALTO';
                alertLevel.className = 'alert-level alert-high';
            }
        }

        function startResourceProduction() {
            setInterval(() => {
                const production = calculateProduction();
                
                Object.entries(production).forEach(([resource, amount]) => {
                    if (amount > 0) {
                        gameState.resources[resource] += amount;
                        
                        if (Math.random() < 0.2) {
                            const buildings = Object.keys(gameState.buildings);
                            const randomBuilding = buildings[Math.floor(Math.random() * buildings.length)];
                            const buildingEl = document.querySelector(`.building.${randomBuilding}`);
                            if (buildingEl) {
                                showResourcePopup(buildingEl, `+${amount}`, '#32CD32');
                            }
                        }
                    }
                });

                updateResources();
                saveGame();
            }, 8000);
        }

        function startPoliceActivity() {
            setInterval(() => {
                if (gameState.riskLevel > 70 && Math.random() < 0.3) {
                    policeRaid();
                }
            }, 30000);
        }

        function policeRaid() {
            const buildings = Object.keys(gameState.buildings);
            const targetBuilding = buildings[Math.floor(Math.random() * buildings.length)];
            const buildingEl = document.querySelector(`.building.${targetBuilding}`);
            
            if (buildingEl) {
                buildingEl.classList.add('police-raid');
                setTimeout(() => buildingEl.classList.remove('police-raid'), 3000);
            }

            const lossPercentage = 0.1 + (gameState.riskLevel / 1000);
            Object.keys(gameState.resources).forEach(resource => {
                const loss = Math.floor(gameState.resources[resource] * lossPercentage);
                gameState.resources[resource] = Math.max(0, gameState.resources[resource] - loss);
            });

            gameState.riskLevel = Math.max(0, gameState.riskLevel - 20);
            
            updateResources();
            saveGame();
            showNotification('üö® BATIDA POLICIAL! Recursos confiscados!');
        }

        function calculateProduction() {
            let production = { drugs: 0, money: 0, weapons: 0, influence: 0 };

            Object.entries(gameState.buildings).forEach(([type, building]) => {
                const buildingType = buildingTypes[type];
                Object.entries(buildingType.baseProduction).forEach(([resource, baseAmount]) => {
                    if (production.hasOwnProperty(resource)) {
                        let amount = Math.floor(baseAmount * building.level * 0.7);
                        
                        if (resource === 'drugs' && gameState.research.chemistry.completed) {
                            amount *= 1.4;
                        }
                        if (resource === 'money' && gameState.research.distribution.completed) {
                            amount *= 1.5;
                        }
                        
                        production[resource] += Math.floor(amount);
                    }
                });
            });

            return production;
        }

        function switchView(viewName) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active');
            });
            
            document.getElementById(viewName + 'View').classList.add('active');
            gameState.currentView = viewName;
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${viewName}"]`).classList.add('active');
        }

        function showResourcePopup(element, text, color) {
            const popup = document.createElement('div');
            popup.className = 'resource-popup';
            popup.textContent = text;
            popup.style.color = color;
            popup.style.left = '50%';
            popup.style.top = '0px';
            
            element.appendChild(popup);
            
            setTimeout(() => popup.remove(), 2000);
        }

        function showTooltip(e, type, data) {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            
            if (type === 'territory') {
                tooltip.innerHTML = `
                    <strong>${data.name}</strong><br>
                    Controle: ${data.control}%<br>
                    Tipo: ${data.type === 'player' ? 'Seu territ√≥rio' : 
                            data.type === 'enemy' ? 'Territ√≥rio inimigo' : 
                            data.type === 'cartel' ? 'Cartel aliado' : 'Neutro'}<br>
                    ${data.type === 'enemy' ? 'Clique para atacar' : 
                      data.type === 'neutral' ? 'Clique para expandir' : 'Clique para info'}
                `;
            } else {
                const buildingType = buildingTypes[type];
                tooltip.innerHTML = `
                    <strong>${buildingType.icon} ${buildingType.name}</strong><br>
                    N√≠vel: ${data.level}<br>
                    ${buildingType.description}<br>
                    <em>Clique para gerenciar</em>
                `;
            }
            
            document.body.appendChild(tooltip);
            
            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = (rect.left + rect.width/2 - tooltip.offsetWidth/2) + 'px';
            tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
        }

        function hideTooltip() {
            const tooltip = document.querySelector('.tooltip');
            if (tooltip) tooltip.remove();
        }

        function showModal(title, content) {
            document.getElementById('modalHeader').textContent = title;
            document.getElementById('modalBody').innerHTML = content;
            document.getElementById('gameModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('gameModal').classList.remove('active');
        }

        function showBonusModal() {
            showModal('üí∞ Opera√ß√£o Especial', `
                <p>Uma oportunidade √∫nica surgiu! Aceite esta miss√£o de alto risco para ganhar recursos valiosos.</p>
                <div class="building-stats">
                    <div class="stat">
                        <div>Recompensa</div>
                        <div>üí∞ $50K<br>üíä 20kg<br>üëë 10 inf</div>
                    </div>
                    <div class="stat">
                        <div>Risco</div>
                        <div>+15% Aten√ß√£o<br>Policial</div>
                    </div>
                </div>
                <button class="action-btn green-btn" onclick="acceptSpecialMission()">üíé Aceitar Miss√£o</button>
                <button class="action-btn" onclick="closeModal()">‚ùå Recusar</button>
            `);
        }

        function acceptSpecialMission() {
            gameState.resources.money += 50000;
            gameState.resources.drugs += 20;
            gameState.resources.influence += 10;
            gameState.riskLevel += 15;
            
            updateResources();
            updateRiskLevel();
            saveGame();
            showNotification('üí∞ Miss√£o especial conclu√≠da! Recursos obtidos!');
            closeModal();
        }

        function showResourceInfo(resource) {
            const icons = { drugs: 'üíä', money: 'üí∞', weapons: 'üî´', influence: 'üëë' };
            const names = { 
                drugs: 'Drogas', 
                money: 'Dinheiro', 
                weapons: 'Armas', 
                influence: 'Influ√™ncia' 
            };
            const descriptions = {
                drugs: 'Produto principal do cartel. Produzido em laborat√≥rios e vendido nas ruas.',
                money: 'Recurso fundamental para todas as opera√ß√µes. Obtido atrav√©s de vendas e lavagem.',
                weapons: 'Essencial para prote√ß√£o e intimida√ß√£o. Usado em confrontos e defesa territorial.',
                influence: 'Poder pol√≠tico e social. Permite corrup√ß√£o e expans√£o de territ√≥rio.'
            };
            
            showModal(`${icons[resource]} ${names[resource]}`, `
                <p>Quantidade atual: <strong>${gameState.resources[resource].toLocaleString()}</strong></p>
                <p>Produ√ß√£o por hora: <strong>+${calculateProduction()[resource]}</strong></p>
                <p>${descriptions[resource]}</p>
                <div style="margin-top: 15px;">
                    <button class="action-btn purple-btn" onclick="showMarketplace('${resource}')">üè™ Mercado Negro</button>
                </div>
            `);
        }

        function showMarketplace(resource) {
            const prices = {
                drugs: { buy: 1000, sell: 800 },
                weapons: { buy: 2000, sell: 1500 },
                influence: { buy: 5000, sell: 3000 }
            };

            if (!prices[resource]) {
                showNotification('‚ùå Este recurso n√£o pode ser comercializado!');
                return;
            }

            showModal('üè™ Mercado Negro', `
                <h3>Negociar ${resource.toUpperCase()}</h3>
                <div class="building-stats">
                    <div class="stat">
                        <div>Pre√ßo de Compra</div>
                        <div>${prices[resource].buy.toLocaleString()}</div>
                    </div>
                    <div class="stat">
                        <div>Pre√ßo de Venda</div>
                        <div>${prices[resource].sell.toLocaleString()}</div>
                    </div>
                </div>
                <div>
                    <input type="number" class="game-input" id="tradeAmount" placeholder="Quantidade" min="1" max="100" value="1">
                    <button class="action-btn green-btn" onclick="buyResource('${resource}')">üí∞ Comprar</button>
                    <button class="action-btn gold-btn" onclick="sellResource('${resource}')">üí∏ Vender</button>
                </div>
            `);
        }

        function buyResource(resource) {
            const amount = parseInt(document.getElementById('tradeAmount').value) || 1;
            const prices = { drugs: 1000, weapons: 2000, influence: 5000 };
            const totalCost = prices[resource] * amount;
            
            if (gameState.resources.money >= totalCost) {
                gameState.resources.money -= totalCost;
                gameState.resources[resource] += amount;
                gameState.riskLevel += amount * 2;
                updateResources();
                updateRiskLevel();
                saveGame();
                showNotification(`Comprou ${amount}x ${resource}!`);
                closeModal();
            } else {
                showNotification('‚ùå Dinheiro insuficiente!');
            }
        }

        function sellResource(resource) {
            const amount = parseInt(document.getElementById('tradeAmount').value) || 1;
            const prices = { drugs: 800, weapons: 1500, influence: 3000 };
            
            if (gameState.resources[resource] >= amount) {
                gameState.resources[resource] -= amount;
                gameState.resources.money += prices[resource] * amount;
                updateResources();
                saveGame();
                showNotification(`Vendeu ${amount}x ${resource}!`);
                closeModal();
            } else {
                showNotification('‚ùå Quantidade insuficiente!');
            }
        }

        function showPoliceActivity() {
            showModal('üö® Atividade Policial', `
                <h3>Relat√≥rio de Intelig√™ncia</h3>
                <div class="rival-operation">
                    <div>
                        <strong>üîç Opera√ß√£o "Quebra-Mola"</strong><br>
                        <small>DEA investigando laborat√≥rios na regi√£o sul</small><br>
                        <small>‚è∞ Prazo: 3 dias</small>
                    </div>
                    <button class="action-btn purple-btn" onclick="sabotaguePolice()">üîß Sabotar</button>
                </div>
                <div class="rival-operation">
                    <div>
                        <strong>üëÆ Patrulhamento Intensivo</strong><br>
                        <small>Aumento de 40% na seguran√ßa local</small><br>
                        <small>‚è∞ Dura√ß√£o: 2 dias</small>
                    </div>
                    <button class="action-btn gold-btn" onclick="bribePolice()">üí∞ Subornar</button>
                </div>
                <div style="margin-top: 20px;">
                    <p><strong>üí° Dica:</strong> Reduza o n√≠vel de risco para evitar opera√ß√µes policiais.</p>
                </div>
            `);
        }

        function sabotaguePolice() {
            if (gameState.resources.influence >= 20) {
                gameState.resources.influence -= 20;
                gameState.riskLevel = Math.max(0, gameState.riskLevel - 25);
                updateResources();
                updateRiskLevel();
                saveGame();
                showNotification('üîß Opera√ß√£o policial sabotada!');
                closeModal();
            } else {
                showNotification('‚ùå Influ√™ncia insuficiente!');
            }
        }

        function bribePolice() {
            if (gameState.resources.money >= 75000) {
                gameState.resources.money -= 75000;
                gameState.riskLevel = Math.max(0, gameState.riskLevel - 40);
                updateResources();
                updateRiskLevel();
                saveGame();
                showNotification('üí∞ Policiais subornados com sucesso!');
                closeModal();
            } else {
                showNotification('‚ùå Dinheiro insuficiente!');
            }
        }

        function attackTerritory(territory) {
            showModal('‚öîÔ∏è Invas√£o de Territ√≥rio', `
                <p>Voc√™ est√° prestes a atacar: <strong>${territory.name}</strong></p>
                <p>Esta opera√ß√£o pode resultar em perdas, mas tamb√©m em controle territorial!</p>
                <div class="building-stats">
                    <div class="stat">
                        <div>Seu Poder</div>
                        <div>${calculateMilitaryPower()}</div>
                    </div>
                    <div class="stat">
                        <div>Risco</div>
                        <div>+30% Aten√ß√£o</div>
                    </div>
                </div>
                <button class="action-btn" onclick="startTerritoryBattle('${territory.name}')">üíÄ Atacar!</button>
                <button class="action-btn green-btn" onclick="closeModal()">üõ°Ô∏è Cancelar</button>
            `);
        }

        function calculateMilitaryPower() {
            return (gameState.organization.enforcer * 25) + 
                   (gameState.organization.lieutenant * 50) + 
                   (gameState.resources.weapons * 10);
        }

        function startTerritoryBattle(targetName) {
            const playerPower = calculateMilitaryPower();
            const enemyPower = Math.random() * 800 + 400;
            const victory = playerPower > enemyPower;
            
            document.body.classList.add('battle-animation');
            setTimeout(() => document.body.classList.remove('battle-animation'), 2000);
            
            if (victory) {
                const rewards = {
                    money: Math.floor(Math.random() * 100000) + 50000,
                    drugs: Math.floor(Math.random() * 50) + 20,
                    influence: Math.floor(Math.random() * 25) + 15
                };
                
                Object.entries(rewards).forEach(([resource, amount]) => {
                    gameState.resources[resource] += amount;
                });
                
                gameState.territoryControl += 15;
                gameState.riskLevel += 30;
                
                updateResources();
                updateRiskLevel();
                saveGame();
                
                showModal('üéâ Territ√≥rio Conquistado!', `
                    <p>Voc√™ dominou ${targetName}!</p>
                    <p><strong>Recursos obtidos:</strong></p>
                    <p>${formatCosts(rewards)}</p>
                    <p>+15% controle territorial</p>
                `);
            } else {
                Object.keys(gameState.organization).forEach(unit => {
                    gameState.organization[unit] = Math.max(0, gameState.organization[unit] - Math.floor(Math.random() * 3));
                });
                gameState.members = Object.values(gameState.organization).reduce((sum, count) => sum + count, 0);
                
                updateResources();
                renderOperations();
                saveGame();
                
                showModal('üòû Ataque Fracassado', `
                    <p>Sua tentativa de conquistar ${targetName} falhou!</p>
                    <p>Alguns membros foram perdidos na batalha.</p>
                    <p>Fortale√ßa sua organiza√ß√£o e tente novamente!</p>
                `);
            }
        }

        function expandTerritory(territory) {
            showModal('üèóÔ∏è Expans√£o Territorial', `
                <p>Expandir para: <strong>${territory.name}</strong></p>
                <p>Esta √°rea neutra pode ser conquistada pacificamente atrav√©s de influ√™ncia.</p>
                <div class="building-stats">
                    <div class="stat">
                        <div>Custo</div>
                        <div>üí∞ $200K<br>üëë 50 influ√™ncia</div>
                    </div>
                    <div class="stat">
                        <div>Benef√≠cio</div>
                        <div>+20% territ√≥rio<br>+$5K/hora</div>
                    </div>
                </div>
                <button class="action-btn gold-btn" onclick="performExpansion('${territory.name}')">üöÄ Expandir</button>
                <button class="action-btn" onclick="closeModal()">‚ùå Cancelar</button>
            `);
        }

        function performExpansion(territoryName) {
            if (gameState.resources.money >= 200000 && gameState.resources.influence >= 50) {
                gameState.resources.money -= 200000;
                gameState.resources.influence -= 50;
                gameState.territoryControl += 20;
                
                updateResources();
                saveGame();
                showNotification(`üèóÔ∏è ${territoryName} conquistado pacificamente!`);
                closeModal();
            } else {
                showNotification('‚ùå Recursos insuficientes para expans√£o!');
            }
        }

        function showTerritoryInfo(territory) {
            showModal(`üè¢ ${territory.name}`, `
                <p>Controle: <strong>${territory.control}%</strong></p>
                <p>Status: <strong>${territory.type === 'player' ? 'Territ√≥rio controlado' : 'Territ√≥rio aliado'}</strong></p>
                <div class="building-stats" style="margin: 15px 0;">
                    <div class="stat">
                        <div>Produ√ß√£o Di√°ria</div>
                        <div>${(territory.control * 100).toLocaleString()}</div>
                    </div>
                    <div class="stat">
                        <div>Seguran√ßa</div>
                        <div>${territory.control > 80 ? 'Alta' : territory.control > 50 ? 'M√©dia' : 'Baixa'}</div>
                    </div>
                </div>
                <p>Este territ√≥rio est√° sob seu controle e contribui para sua receita di√°ria.</p>
            `);
        }

        function deployUnit(unitType) {
            showModal('üéØ Miss√£o Especial', `
                <h3>Destacar ${unitTypes[unitType].name}</h3>
                <p>Escolha uma miss√£o para seus ${unitTypes[unitType].name.toLowerCase()}s:</p>
                <button class="action-btn purple-btn" onclick="sendMission('${unitType}', 'collect')">üí∞ Coletar Prote√ß√£o</button>
                <button class="action-btn gold-btn" onclick="sendMission('${unitType}', 'sabotage')">üîß Sabotar Rivais</button>
                <button class="action-btn green-btn" onclick="sendMission('${unitType}', 'expand')">üó∫Ô∏è Explorar Territ√≥rio</button>
                <button class="action-btn" onclick="closeModal()">‚ùå Cancelar</button>
            `);
        }

        function sendMission(unitType, missionType) {
            if (gameState.organization[unitType] <= 0) {
                showNotification('‚ùå Nenhuma unidade dispon√≠vel!');
                return;
            }

            const missions = {
                collect: { 
                    reward: { money: 25000 }, 
                    risk: 5, 
                    name: 'Coleta de Prote√ß√£o' 
                },
                sabotage: { 
                    reward: { influence: 15 }, 
                    risk: 15, 
                    name: 'Sabotagem' 
                },
                expand: { 
                    reward: { drugs: 10, money: 15000 }, 
                    risk: 10, 
                    name: 'Explora√ß√£o' 
                }
            };

            const mission = missions[missionType];
            gameState.organization[unitType]--;
            gameState.members--;
            gameState.riskLevel += mission.risk;

            Object.entries(mission.reward).forEach(([resource, amount]) => {
                gameState.resources[resource] += amount;
            });

            updateResources();
            updateRiskLevel();
            renderOperations();
            saveGame();
            
            showNotification(`‚úÖ ${mission.name} iniciada! ${unitTypes[unitType].name} destacado.`);
            closeModal();

            setTimeout(() => {
                gameState.organization[unitType]++;
                gameState.members++;
                renderOperations();
                showNotification(`üîÑ ${unitTypes[unitType].name} retornou da miss√£o!`);
                saveGame();
            }, 15000);
        }

        function showCartelStats() {
            const totalProduction = calculateProduction();
            const dailyIncome = (totalProduction.money * 24);
            
            showModal('üìä Relat√≥rio Completo do Cartel', `
                <h3>Estat√≠sticas Detalhadas</h3>
                <div class="building-stats">
                    <div class="stat">
                        <div>Receita Di√°ria</div>
                        <div>${dailyIncome.toLocaleString()}</div>
                    </div>
                    <div class="stat">
                        <div>Efici√™ncia</div>
                        <div>${Math.floor(gameState.reputation * 10)}%</div>
                    </div>
                    <div class="stat">
                        <div>Territ√≥rio</div>
                        <div>${gameState.territoryControl}%</div>
                    </div>
                    <div class="stat">
                        <div>Poder Militar</div>
                        <div>${calculateMilitaryPower()}</div>
                    </div>
                </div>
                <h4>Distribui√ß√£o de Membros:</h4>
                <div class="building-stats">
                    ${Object.entries(gameState.organization).map(([unit, count]) => `
                        <div class="stat">
                            <div>${unitTypes[unit].name}</div>
                            <div>${count}</div>
                        </div>
                    `).join('')}
                </div>
                <p style="margin-top: 15px;"><strong>Pr√≥xima Meta:</strong> Alcan√ßar ranking #1 e controlar 100% do territ√≥rio!</p>
                <button class="action-btn purple-btn" onclick="resetGame()">üîÑ Resetar Progresso</button>
            `);
        }

        function resetGame() {
            if (confirm('‚ö†Ô∏è Tem certeza que deseja resetar todo o progresso?')) {
                localStorage.removeItem('cartelEmpire');
                location.reload();
            }
        }

        function showIntelReport() {
            showModal('üìä Relat√≥rio de Intelig√™ncia', `
                <h3>Atividade dos Rivais</h3>
                <div class="rival-operation">
                    <div>
                        <strong>üè¥‚Äç‚ò†Ô∏è Los Hermanos</strong><br>
                        <small>Movimento suspeito no porto norte</small><br>
                        <small>Threat Level: Alto</small>
                    </div>
                </div>
                <div class="rival-operation">
                    <div>
                        <strong>üéØ M√°fia Italiana</strong><br>
                        <small>Expandindo opera√ß√µes de lavagem</small><br>
                        <small>Threat Level: M√©dio</small>
                    </div>
                </div>
                <div class="rival-operation">
                    <div>
                        <strong>‚öîÔ∏è Gangue Rival</strong><br>
                        <small>Recrutamento massivo em andamento</small><br>
                        <small>Threat Level: Baixo</small>
                    </div>
                </div>
                <p style="margin-top: 15px;"><strong>Recomenda√ß√£o:</strong> Fortale√ßa defesas e considere ataques preventivos.</p>
            `);
        }

        function showMarketAnalysis() {
            showModal('üìà An√°lise de Mercado', `
                <h3>Tend√™ncias do Mercado Negro</h3>
                <div class="building-stats">
                    <div class="stat">
                        <div>üíä Demanda de Drogas</div>
                        <div style="color: #32CD32;">üìà +15%</div>
                    </div>
                    <div class="stat">
                        <div>üî´ Pre√ßo das Armas</div>
                        <div style="color: #FF6347;">üìâ -8%</div>
                    </div>
                    <div class="stat">
                        <div>üëë Valor da Influ√™ncia</div>
                        <div style="color: #32CD32;">üìà +22%</div>
                    </div>
                    <div class="stat">
                        <div>üö® Atividade Policial</div>
                        <div style="color: #FFD700;">üìä Est√°vel</div>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Oportunidades:</h4>
                    <p>‚Ä¢ Alta demanda por drogas sint√©ticas</p>
                    <p>‚Ä¢ Pre√ßos baixos de armas = boa hora para comprar</p>
                    <p>‚Ä¢ Influ√™ncia pol√≠tica em alta valoriza√ß√£o</p>
                </div>
            `);
        }

        function triggerRandomEvent() {
            const events = [
                {
                    title: 'üéØ Oportunidade de Neg√≥cio',
                    message: 'Um novo cliente quer fazer um pedido grande de 30kg!',
                    requirement: 'drugs >= 30',
                    action: () => {
                        if (gameState.resources.drugs >= 30) {
                            gameState.resources.money += 45000;
                            gameState.resources.drugs -= 30;
                            gameState.riskLevel += 10;
                            updateResources();
                            updateRiskLevel();
                            saveGame();
                            showNotification('üí∞ Grande neg√≥cio fechado! +$45K, -30kg drogas');
                        } else {
                            showNotification('‚ùå Drogas insuficientes para o pedido!');
                        }
                    }
                },
                {
                    title: 'üîç Informante',
                    message: 'Um policial corrupto oferece informa√ß√µes sobre opera√ß√£o planejada.',
                    requirement: 'money >= 15000',
                    action: () => {
                        if (gameState.resources.money >= 15000) {
                            gameState.riskLevel = Math.max(0, gameState.riskLevel - 25);
                            gameState.resources.money -= 15000;
                            updateResources();
                            updateRiskLevel();
                            saveGame();
                            showNotification('üïµÔ∏è Intel valiosa obtida! -$15K, risco reduzido');
                        } else {
                            showNotification('‚ùå Dinheiro insuficiente para pagar informante!');
                        }
                    }
                },
                {
                    title: '‚öîÔ∏è Conflito Territorial',
                    message: 'Rivais atacaram um de seus pontos de venda!',
                    requirement: 'none',
                    action: () => {
                        const losses = Math.floor(Math.random() * 8000) + 3000;
                        const weaponLoss = Math.min(5, gameState.resources.weapons);
                        gameState.resources.money = Math.max(0, gameState.resources.money - losses);
                        gameState.resources.weapons = Math.max(0, gameState.resources.weapons - weaponLoss);
                        updateResources();
                        saveGame();
                        showNotification(`üí• Ataque sofrido! -${losses.toLocaleString()}, -${weaponLoss} armas`);
                    }
                },
                {
                    title: 'üíé Contrato Especial',
                    message: 'Um pol√≠tico corrupto oferece prote√ß√£o em troca de influ√™ncia.',
                    requirement: 'influence >= 25',
                    action: () => {
                        if (gameState.resources.influence >= 25) {
                            gameState.resources.influence -= 25;
                            gameState.riskLevel = Math.max(0, gameState.riskLevel - 30);
                            gameState.territoryControl += 10;
                            updateResources();
                            updateRiskLevel();
                            saveGame();
                            showNotification('ü§ù Prote√ß√£o pol√≠tica adquirida! +10% territ√≥rio');
                        } else {
                            showNotification('‚ùå Influ√™ncia insuficiente para o contrato!');
                        }
                    }
                }
            ];

            const randomEvent = events[Math.floor(Math.random() * events.length)];
            
            showModal('üì∞ Evento Inesperado', `
                <h3>${randomEvent.title}</h3>
                <p>${randomEvent.message}</p>
                ${randomEvent.requirement !== 'none' ? `<p><small>Requisito: ${randomEvent.requirement.replace('>=', ' m√≠nimo ')}</small></p>` : ''}
                <button class="action-btn gold-btn" onclick="handleRandomEvent(${events.indexOf(randomEvent)})">‚úÖ Aceitar</button>
                <button class="action-btn" onclick="closeModal()">‚ùå Ignorar</button>
            `);
        }

        function handleRandomEvent(eventIndex) {
            const events = [
                () => {
                    if (gameState.resources.drugs >= 30) {
                        gameState.resources.money += 45000;
                        gameState.resources.drugs -= 30;
                        gameState.riskLevel += 10;
                        updateResources();
                        updateRiskLevel();
                        saveGame();
                        showNotification('üí∞ Grande neg√≥cio fechado! +$45K, -30kg drogas');
                    } else {
                        showNotification('‚ùå Drogas insuficientes para o pedido!');
                    }
                },
                () => {
                    if (gameState.resources.money >= 15000) {
                        gameState.riskLevel = Math.max(0, gameState.riskLevel - 25);
                        gameState.resources.money -= 15000;
                        updateResources();
                        updateRiskLevel();
                        saveGame();
                        showNotification('üïµÔ∏è Intel valiosa obtida! -$15K, risco reduzido');
                    } else {
                        showNotification('‚ùå Dinheiro insuficiente para pagar informante!');
                    }
                },
                () => {
                    const losses = Math.floor(Math.random() * 8000) + 3000;
                    const weaponLoss = Math.min(5, gameState.resources.weapons);
                    gameState.resources.money = Math.max(0, gameState.resources.money - losses);
                    gameState.resources.weapons = Math.max(0, gameState.resources.weapons - weaponLoss);
                    updateResources();
                    saveGame();
                    showNotification(`üí• Ataque sofrido! -${losses.toLocaleString()}, -${weaponLoss} armas`);
                },
                () => {
                    if (gameState.resources.influence >= 25) {
                        gameState.resources.influence -= 25;
                        gameState.riskLevel = Math.max(0, gameState.riskLevel - 30);
                        gameState.territoryControl += 10;
                        updateResources();
                        updateRiskLevel();
                        saveGame();
                        showNotification('ü§ù Prote√ß√£o pol√≠tica adquirida! +10% territ√≥rio');
                    } else {
                        showNotification('‚ùå Influ√™ncia insuficiente para o contrato!');
                    }
                }
            ];
            
            events[eventIndex]();
            closeModal();
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #8B0000, #DC143C);
                color: #FFD700;
                padding: 15px 20px;
                border-radius: 10px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.5);
                z-index: 1001;
                font-weight: bold;
                animation: slideIn 0.3s ease;
                border: 2px solid #FFD700;
                max-width: 300px;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // Tab switching
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchView(tab.dataset.tab);
            });
        });

        // Mobile panel toggle
        if (window.innerWidth <= 768) {
            const panel = document.getElementById('sidePanel');
            panel.addEventListener('click', () => {
                panel.classList.toggle('expanded');
            });
        }

        // Close modal when clicking outside
        document.getElementById('gameModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) {
                closeModal();
            }
        });

        // Add CSS animations for notifications
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            .battle-animation {
                animation: battleShake 0.5s infinite;
            }
            @keyframes battleShake {
                0%, 100% { transform: translate(0); }
                25% { transform: translate(-2px, -2px); }
                50% { transform: translate(2px, -2px); }
                75% { transform: translate(-2px, 2px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
